import{_ as s,o as a,c as n,a as l}from"./app.365ec0c3.js";const A=JSON.parse('{"title":"React Suspenseã€Lazy åŸç†","description":"","frontmatter":{},"headers":[{"level":2,"title":"ä¸€ã€React.lazy è§£æ","slug":"ä¸€ã€react-lazy-è§£æ","link":"#ä¸€ã€react-lazy-è§£æ","children":[]},{"level":2,"title":"äºŒã€Suspense è§£æ","slug":"äºŒã€suspense-è§£æ","link":"#äºŒã€suspense-è§£æ","children":[]},{"level":2,"title":"ä¸‰ã€Suspenseã€lazyæµç¨‹è§£æ","slug":"ä¸‰ã€suspenseã€lazyæµç¨‹è§£æ","link":"#ä¸‰ã€suspenseã€lazyæµç¨‹è§£æ","children":[{"level":3,"title":"1ã€thenableæ˜¯ä»€ä¹ˆï¼Œä¸åº”è¯¥æ˜¯Promiseå—ï¼Ÿ","slug":"_1ã€thenableæ˜¯ä»€ä¹ˆ-ä¸åº”è¯¥æ˜¯promiseå—","link":"#_1ã€thenableæ˜¯ä»€ä¹ˆ-ä¸åº”è¯¥æ˜¯promiseå—","children":[]},{"level":3,"title":"2ã€attachPromiseToSuspenseè¿™ä¸ªå‡½æ•°æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿ","slug":"_2ã€attachpromisetosuspenseè¿™ä¸ªå‡½æ•°æ˜¯å¹²å˜›ç”¨çš„","link":"#_2ã€attachpromisetosuspenseè¿™ä¸ªå‡½æ•°æ˜¯å¹²å˜›ç”¨çš„","children":[]},{"level":3,"title":"3ã€å¦‚æœ Suspense ä¸­æœ‰å¤šä¸ª lazyï¼ŒReact æ˜¯å¦‚ä½• æ‰¹é‡ lazy åŠ è½½å’Œè°ƒåº¦ çš„ï¼Ÿ","slug":"_3ã€å¦‚æœ-suspense-ä¸­æœ‰å¤šä¸ª-lazy-react-æ˜¯å¦‚ä½•-æ‰¹é‡-lazy-åŠ è½½å’Œè°ƒåº¦-çš„","link":"#_3ã€å¦‚æœ-suspense-ä¸­æœ‰å¤šä¸ª-lazy-react-æ˜¯å¦‚ä½•-æ‰¹é‡-lazy-åŠ è½½å’Œè°ƒåº¦-çš„","children":[]}]},{"level":2,"title":"é¢è¯•å¤§ç™½è¯æ€»ç»“","slug":"é¢è¯•å¤§ç™½è¯æ€»ç»“","link":"#é¢è¯•å¤§ç™½è¯æ€»ç»“","children":[]}],"relativePath":"React/React_Suspense&Lazy.md","lastUpdated":1754467699000}'),p={name:"React/React_Suspense&Lazy.md"},o=l(`<h1 id="react-suspenseã€lazy-åŸç†" tabindex="-1">React Suspenseã€Lazy åŸç† <a class="header-anchor" href="#react-suspenseã€lazy-åŸç†" aria-hidden="true">#</a></h1><hr><p>React çš„ Suspense å’Œ lazy æ˜¯ç”¨äºç»„ä»¶æ‡’åŠ è½½ï¼ˆCode Splittingï¼‰å’Œå¼‚æ­¥æ¸²æŸ“ç®¡ç†çš„å·¥å…·ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å®ç°æ›´ä¼˜é›…çš„å¼‚æ­¥ UI åŠ è½½ä½“éªŒã€‚</p><p>å…ˆä¸¾ä¸ªä¾‹å­å§</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Suspense</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> MyComponent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lazy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./MyComponent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Suspense</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">fallback</span><span style="color:#89DDFF;">={&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">åŠ è½½ä¸­...</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;}&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">MyComponent</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">Suspense</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ğŸŒŸ ä¸€å¥è¯ç†è§£</p><ul><li><p><code>React.lazy()</code>ï¼šè®©ä½ â€œæ‡’åŠ è½½â€ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€ importã€‚</p></li><li><p><code>Suspense</code>ï¼šç”¨æ¥åŒ…è£¹æ‡’åŠ è½½ç»„ä»¶ï¼ŒæŒ‡å®šåŠ è½½æ—¶çš„ fallbackï¼ˆå…œåº• UIï¼‰ã€‚</p></li><li><p>å®ƒä»¬çš„åº•å±‚ä¾èµ–äº React çš„ Fiber æ¶æ„ å’Œ å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ã€‚</p></li></ul><h2 id="ä¸€ã€react-lazy-è§£æ" tabindex="-1">ä¸€ã€React.lazy è§£æ <a class="header-anchor" href="#ä¸€ã€react-lazy-è§£æ" aria-hidden="true">#</a></h2><p>å…ˆæ¥çœ‹çœ‹<code>React.lazy(fn)</code>éƒ½å¸®æˆ‘ä»¬åšäº†äº›ä»€ä¹ˆï¼Ÿ</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> MyComponent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lazy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./MyComponent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><code>React.lazy</code>å†…éƒ¨ç›¸å½“äºè¿”å›äº†ä¸€ä¸ªã€Œå ä½ç»„ä»¶ã€ï¼Œå¹¶è®°å½•è¿™ä¸ª import()çš„ thenableã€‚React ä¼šæ ¹æ®è¿™ä¸ª thenable æ˜¯å¦ resolve æ¥å†³å®šï¼š</p><ul><li><p><strong>è¿˜æ²¡ resolve</strong>ï¼šä¸æ¸²æŸ“ç»„ä»¶å†…å®¹ï¼ŒæŒ‚èµ·ï¼ˆsuspendï¼‰æ¸²æŸ“ã€‚</p></li><li><p><strong>å‘ç”Ÿé”™è¯¯</strong>ï¼šèµ° error boundaryã€‚</p></li><li><p><strong>resolve å®Œæˆ</strong>ï¼šçœŸæ­£åŠ è½½è¿™ä¸ªç»„ä»¶ï¼Œé‡æ–°æ¸²æŸ“ã€‚</p></li></ul><p>æˆ‘ä»¬å†çœ‹çœ‹Lazyå†…éƒ¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lazy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ctor</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    $$typeof</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REACT_LAZY_TYPE</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    _ctor</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctor</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    _status</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    _result</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>React.lazy</code>è¿”å›çš„å¯¹è±¡ï¼ŒåŒ…å«ä¸‰ä¸ªå±æ€§ï¼š</p><ul><li><p><code>$$typeof</code>ï¼šæ ‡è¯†è¿™æ˜¯ä¸€ä¸ª lazy ç»„ä»¶ã€‚</p></li><li><p><code>_ctor</code>ï¼šè®°å½•è¿™ä¸ªç»„ä»¶çš„ import() thenableã€‚</p></li><li><p><code>_status</code> å’Œ <code>_result</code>ï¼šç”¨äºè®°å½•è¿™ä¸ªç»„ä»¶çš„åŠ è½½çŠ¶æ€å’ŒåŠ è½½ç»“æœã€‚</p></li></ul><p>ç»„ä»¶åŠ è½½çŠ¶æ€è¯´æ˜ï¼š</p><table><thead><tr><th>çŠ¶æ€ç </th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-1</td><td>æœªåˆå§‹åŒ–ï¼ˆinitialï¼‰</td></tr><tr><td>0</td><td>æ­£åœ¨åŠ è½½ä¸­ï¼ˆpendingï¼‰</td></tr><tr><td>1</td><td>å·²åŠ è½½å®Œæˆï¼ˆresolvedï¼‰</td></tr><tr><td>2</td><td>åŠ è½½å¤±è´¥ï¼ˆrejectedï¼‰</td></tr></tbody></table><p>å½“è¿™ä¸ªç»„ä»¶é¦–æ¬¡è¢«æ¸²æŸ“æ—¶ï¼ŒReact ä¼šè°ƒç”¨ _ctor() å¼€å§‹åŠ è½½æ¨¡å—ï¼ŒæŠŠ thenable å­˜åˆ° _resultï¼Œå¹¶æŒ‚èµ·å½“å‰ Fiber èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œæˆ‘å†™ä¸€æ®µä¼ªä»£ç ï¼Œæ¥æ¨¡æ‹Ÿ <code>React.lazy</code> çš„è¡Œä¸ºï¼š</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lazyInitializer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">payload</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ç¬¬ä¸€æ¬¡åˆå§‹åŒ–</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_ctor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenable</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ctor</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œ import()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">     </span><span style="color:#676E95;font-style:italic;">// è®¾ç½®ä¸º pending</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenable</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">thenable</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">              </span><span style="color:#676E95;font-style:italic;">// æ ‡è®°ä¸º resolved</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">default</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å­˜å‚¨å¯¼å‡ºçš„ç»„ä»¶</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;font-style:italic;">error</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_result</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// è¿”å›çœŸæ­£çš„ç»„ä»¶</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">_result</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// æŠ›å‡º thenable æˆ– Error</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="äºŒã€suspense-è§£æ" tabindex="-1">äºŒã€Suspense è§£æ <a class="header-anchor" href="#äºŒã€suspense-è§£æ" aria-hidden="true">#</a></h2><p>å…ˆæ¥çœ‹çœ‹<code>Suspense</code>éƒ½å¸®æˆ‘ä»¬åšäº†äº›ä»€ä¹ˆï¼Ÿ</p><ul><li><p>å½“ lazy åŠ è½½çš„ç»„ä»¶è¿˜æ²¡åŠ è½½å®Œæˆï¼Œä¼š <strong>â€œæŒ‚èµ·â€å½“å‰çš„æ¸²æŸ“æµç¨‹ï¼ˆthrow Promiseï¼‰</strong>ã€‚</p></li><li><p>React å‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„ <code>Suspense ç»„ä»¶</code>ï¼Œç„¶åæ¸²æŸ“å®ƒçš„ fallbackã€‚</p></li><li><p>thenable resolve åï¼Œé‡æ–°è§¦å‘æ¸²æŸ“ã€‚</p></li></ul><h2 id="ä¸‰ã€suspenseã€lazyæµç¨‹è§£æ" tabindex="-1">ä¸‰ã€Suspenseã€lazyæµç¨‹è§£æ <a class="header-anchor" href="#ä¸‰ã€suspenseã€lazyæµç¨‹è§£æ" aria-hidden="true">#</a></h2><p>æˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹Suspenseã€lazyæµç¨‹ï¼š</p><p>1ã€å½“ lazy ç»„ä»¶é¦–æ¬¡åŠ è½½æ—¶ï¼Œä¼šè°ƒç”¨ <code>lazyInitializer()</code>ï¼Œå¦‚æœç»„ä»¶è¿˜æ²¡åŠ è½½å®Œæˆï¼Œä¼šï¼ˆthrowï¼‰æŠ›å‡º thenableï¼›<br> 2ã€æ­¤æ—¶ React æ¸²æŸ“æµç¨‹ä¼šä¸­æ–­ï¼Œä¼šæ•è·åˆ°è¿™ä¸ª <code>thenable</code>ï¼Œæ­¤æ—¶ä¼šè§¦å‘ <code>renderRootSuspend()</code> æµç¨‹ï¼Œå¼€å§‹æŸ¥æ‰¾<code>Suspenseè¾¹ç•Œ</code>ï¼›<br> 3ã€å…¶ä¸­ä¼šæ²¿ç€ Fiber å‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„ <code>SuspenseBoundary</code>ï¼Œæ ¹æ® returné“¾ ç›´åˆ°æ‰¾åˆ° tag === 13 çš„èŠ‚ç‚¹ï¼Œå°±æ˜¯æœ€è¿‘çš„ <code>&lt;Suspense/&gt;</code>ï¼Œç„¶åæ¸²æŸ“å®ƒçš„ fallbackï¼›<br> 4ã€å½“ thenable resolve åï¼ŒReact ä¼šé‡æ–°è§¦å‘æ¸²æŸ“ï¼Œæ¸²æŸ“çœŸæ­£çš„ç»„ä»¶ã€‚</p><p>æˆ‘å‚è€ƒ<code>renderRootSuspend</code>çš„é€»è¾‘å†™äº†ä¸ª<code>handleSuspension</code>ï¼Œå…¶ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">handleSuspension</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">fiber</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">promise</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">parent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isSuspenseComponent</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">parent</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">attachPromiseToSuspense</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">parent</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">promise</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">parent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parent</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">return</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å‘ä¸ŠæŸ¥æ‰¾</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ²¡æ‰¾åˆ° Suspense è¾¹ç•Œï¼Œè§¦å‘å…¨å±€é”™è¯¯</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> SuspenseComponent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">13</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">isSuspenseComponent</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">fiber</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tag</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SuspenseComponent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯ä¼šæœ‰ç–‘é—®å‘ï¼Ÿ</p><ul><li><p>thenableæ˜¯ä»€ä¹ˆï¼Œä¸åº”è¯¥æ˜¯Promiseå—ï¼Ÿ</p></li><li><p>attachPromiseToSuspenseè¿™ä¸ªå‡½æ•°æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿ</p></li><li><p>å¦‚æœ Suspense ä¸­æœ‰å¤šä¸ª lazyï¼ŒReact æ˜¯å¦‚ä½• æ‰¹é‡ lazy åŠ è½½å’Œè°ƒåº¦ çš„ï¼Ÿ</p></li></ul><h3 id="_1ã€thenableæ˜¯ä»€ä¹ˆ-ä¸åº”è¯¥æ˜¯promiseå—" tabindex="-1">1ã€thenableæ˜¯ä»€ä¹ˆï¼Œä¸åº”è¯¥æ˜¯Promiseå—ï¼Ÿ <a class="header-anchor" href="#_1ã€thenableæ˜¯ä»€ä¹ˆ-ä¸åº”è¯¥æ˜¯promiseå—" aria-hidden="true">#</a></h3><p>React åœ¨å¤„ç†æŒ‚èµ·é€»è¾‘æ—¶ï¼ˆæ¯”å¦‚ lazy()ã€use()ã€suspense cacheï¼‰ä¸å¼ºä¾èµ–æ ‡å‡†çš„åŸç”Ÿ Promiseï¼Œå®ƒåªå…³å¿ƒæ˜¯å¦æœ‰<code>.then() æ–¹æ³•</code>ï¼ŒReact å°±è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªâ€œå¯ä»¥è¢«æŒ‚èµ·ç­‰å¾…â€çš„å¯¹è±¡ â€”â€” è¿™å°±å« <code>thenable</code>ã€‚</p><p>åœ¨ <code>React.lazy</code> é‡Œï¼Œthenable å°±æ˜¯ <code>() =&gt; import() </code>æ‰§è¡Œåè¿”å›çš„ Promise</p><p>ä¸ºä»€ä¹ˆä¸æ˜¯Promiseå‘¢ï¼Œ æ˜¯å› ä¸ºæ¯”å¦‚ <strong>React Cacheã€Server Components</strong> å¯èƒ½ç”¨è‡ªå®šä¹‰å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦æ›´å®½æ³›ã€å…¼å®¹æ€§æ›´å¼ºçš„ thenableã€‚</p><h3 id="_2ã€attachpromisetosuspenseè¿™ä¸ªå‡½æ•°æ˜¯å¹²å˜›ç”¨çš„" tabindex="-1">2ã€attachPromiseToSuspenseè¿™ä¸ªå‡½æ•°æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿ <a class="header-anchor" href="#_2ã€attachpromisetosuspenseè¿™ä¸ªå‡½æ•°æ˜¯å¹²å˜›ç”¨çš„" aria-hidden="true">#</a></h3><p><code>attachPromiseToSuspense</code>å‡½æ•°çš„ä½œç”¨æ˜¯ï¼ŒæŠŠ thenable æŒ‚è½½åˆ° Suspense ç»„ä»¶çš„ Fiber èŠ‚ç‚¹ï¼Œç”¨äºåç»­çš„é‡æ–°æŒ‚è½½å’Œæ¢å¤æ“ä½œã€‚</p><p>è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æœ‰ä¸¤ç‚¹ï¼š</p><p><strong>1. å°† thenable åŠ å…¥ SuspenseFiber çš„ wakeables åˆ—è¡¨</strong></p><p>Suspense è¾¹ç•Œä¸Šçš„fiberèŠ‚ç‚¹ï¼Œå†…éƒ¨çš„ memoizedStateä¸­ ç»´æŠ¤äº†ä¸€ä¸ªé›†åˆï¼ˆé€šå¸¸æ˜¯ wakeables Setï¼‰ï¼Œç”¨äºè®°å½•æœ‰å“ªäº› thenable è®©å®ƒå¤„äºâ€œæŒ‚èµ·â€çŠ¶æ€ã€‚<br> è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼šä¸€æ—¦thenable resolvedï¼Œå°±å¯ä»¥çŸ¥é“æ˜¯å“ªä¸ª Suspense æ­£åœ¨ç­‰å¾…å®ƒã€‚</p><p><strong>2. ç›‘å¬ thenable çš„ .then å›è°ƒï¼Œé‡æ–°è°ƒåº¦ç»„ä»¶æ›´æ–°</strong></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">suspenseFiber</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">memoizedState </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">wakeables</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">Thenable</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">thenable</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ç»„ä»¶æ‡’åŠ è½½å®Œæˆï¼ŒPromise resolved</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é‡æ–°è°ƒåº¦è¯¥ suspense ç»„ä»¶æ¸²æŸ“</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">......</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">retrySuspenseBoundary</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">suspenseFiber</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>ä½ å¯ä»¥æŠŠè¿™çœ‹ä½œæ˜¯</strong>ï¼š</p><p>â€œåœ¨ Suspense ä¸ŠæŒ‚ä¸€ä¸ªé’©å­ï¼Œé’©ä½æ‰€æœ‰è®©å®ƒæŒ‚èµ·çš„ Promiseï¼Œåªè¦è¿™äº› Promise ä¸­ä»»ä½•ä¸€ä¸ªå®Œæˆï¼Œå°±é‡æ–°å°è¯•æ¸²æŸ“ã€‚â€</p><h3 id="_3ã€å¦‚æœ-suspense-ä¸­æœ‰å¤šä¸ª-lazy-react-æ˜¯å¦‚ä½•-æ‰¹é‡-lazy-åŠ è½½å’Œè°ƒåº¦-çš„" tabindex="-1">3ã€å¦‚æœ Suspense ä¸­æœ‰å¤šä¸ª lazyï¼ŒReact æ˜¯å¦‚ä½• æ‰¹é‡ lazy åŠ è½½å’Œè°ƒåº¦ çš„ï¼Ÿ <a class="header-anchor" href="#_3ã€å¦‚æœ-suspense-ä¸­æœ‰å¤šä¸ª-lazy-react-æ˜¯å¦‚ä½•-æ‰¹é‡-lazy-åŠ è½½å’Œè°ƒåº¦-çš„" aria-hidden="true">#</a></h3><p>ä½ å¯èƒ½æœ‰å¤šä¸ª lazy() ç»„ä»¶ï¼Œæ¯”å¦‚ï¼š</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> LazyA </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lazy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./A</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// tenable A</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> LazyB </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lazy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./B</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// tenable B</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Suspense</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">fallback</span><span style="color:#89DDFF;">={&lt;</span><span style="color:#FFCB6B;">Loading</span><span style="color:#89DDFF;"> /&gt;}&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">LazyA</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">LazyB</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">Suspense</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>å½“è¿™ä¸¤ä¸ªç»„ä»¶çš„æ¨¡å—éƒ½æœªåŠ è½½å®Œæˆï¼ŒReact ä¸ä¼šä¸€ä¸ªä¸ªå•ç‹¬å¤„ç†ï¼Œè€Œæ˜¯ä¸€æ¬¡æ€§æŒ‚èµ·æ•´ä¸ªå­æ ‘ã€‚</p><p>å…¶<strong>è°ƒåº¦æ ¸å¿ƒ</strong>å°±æ˜¯ ä¼˜å…ˆçº§ + æ‰¹å¤„ç†ï¼Œ React ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥è°ƒåº¦å™¨ <code>Scheduler</code> + <code>Fiber work loop</code>ã€‚</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨å‰é¢æåˆ°çš„è¿™ä¸€ä»£ç å—ä¸­ï¼Œå…¶ä¸­çš„retrySuspenseBoundaryä¼šé‡æ–°è¢«è°ƒåº¦æ›´æ–°ã€‚</span></span>
<span class="line"><span style="color:#A6ACCD;">thenable</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">retrySuspenseBoundary</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">suspenseFiber</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// suspenseFiber å°±æ˜¯è§¦å‘ suspend çš„ Lazy ç»„ä»¶</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>æ€»ç»“ä¸€ä¸‹ï¼šä½ ç”¨äº†å¤šä¸ªæ‡’åŠ è½½å­ç»„ä»¶lazy() åŒæ—¶æŒ‚èµ·<br> 1.æš‚åœå½“å‰æ‰§è¡Œçš„åˆ†æ”¯<br> 2.æŠŠæ‰€æœ‰ æœª resolve çš„ thenable æŒ‚åˆ°åŒä¸€ä¸ª <code>Suspense boundary</code> ä¸Š<br> 3.ä¸ºè¿™äº› Promise ç»Ÿä¸€æ³¨å†Œå›è°ƒï¼ˆbatch retryï¼‰<br> 4.ç­‰å¾…å®ƒä»¬ resolve åï¼Œæ•´ä¸ª Suspense è¾¹ç•Œé‡æ–°è¿›å…¥è°ƒåº¦æ¸²æŸ“æµç¨‹</p></blockquote><p><strong>ä¸å¿…æ‹…å¿ƒä¼šè§¦å‘å¤šæ¬¡retryï¼Œæ¯ä¸ªthenableéƒ½æ³¨å†Œ.then()å„è‡ªç›‘å¬ï¼Œä½†éƒ½æŒ‡å‘ç›¸åŒçš„ suspenseFiberï¼ŒretrySuspenseBoundary æœ€ç»ˆè§¦å‘åŒä¸€ä¸ªç»„ä»¶æ ‘çš„é‡æ–°æ¸²æŸ“ï¼Œå¹¶ä¸”ç”±è°ƒåº¦å™¨è‡ªåŠ¨å°†å¤šä¸ª retry åˆå¹¶æ‰§è¡Œï¼ˆå‚è€ƒä¼˜å…ˆçº§/ä»»åŠ¡å¹¶å‘å“ˆï¼Œè¿™å°±æ˜¯reactä¸­çš„ä¸€ä¸ªå†…éƒ¨ä¼˜åŒ–ã€‚</strong></p><p>å› æ­¤è¡¨ç°ä¸Šå°±æ˜¯ï¼šåªä¼šæ˜¾ç¤ºä¸€æ¬¡ fallbackï¼Œç„¶åæ‰€æœ‰æ‡’åŠ è½½ç»„ä»¶ä¸€èµ·åŠ è½½å®Œæ¯•åä¸€èµ·å±•ç¤ºã€‚</p><h2 id="é¢è¯•å¤§ç™½è¯æ€»ç»“" tabindex="-1">é¢è¯•å¤§ç™½è¯æ€»ç»“ <a class="header-anchor" href="#é¢è¯•å¤§ç™½è¯æ€»ç»“" aria-hidden="true">#</a></h2><p><strong>è¯·è®²ä¸€ä¸‹ä½ ç†è§£çš„Suspense&amp;Lazyæ‰§è¡Œæµç¨‹ï¼š</strong></p><ol><li><p>react åœ¨éå†èŠ‚ç‚¹æ—¶ï¼Œä¼šé‡åˆ° <code>lazy</code>æ‡’åŠ è½½ç»„ä»¶ï¼Œæ­¤æ—¶è¿˜æ²¡åŠ è½½ <code>lazy</code> ä¸­ <code>import çš„ç»„ä»¶</code>ï¼Œæ‰€ä»¥ä¼š <code>throw promise</code>ï¼Œç„¶å <code>fiber</code> ä¼šä¸æ–­ return æ ¹æ® <code>tag === 13</code> åˆ¤æ–­å»æ‰¾åˆ°æœ€è¿‘çš„ <code>Suspense</code>ï¼Œç„¶åæ‰§è¡Œ <code>fallback</code>ï¼›</p></li><li><p>ç„¶åç­‰å¾… <code>lazy</code> ä¸­ç»„ä»¶åŠ è½½ï¼Œå…¶å†…éƒ¨æœ‰ <code>statusçŠ¶æ€</code>ï¼Œä»¥åŠ <code>result</code> ç”¨æ¥å­˜å‚¨ <code>() =&gt; import(...)</code> çš„æ‰§è¡Œç»“æœã€‚åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºè¿˜æ²¡åŠ è½½å®Œæˆï¼Œæ­¤æ—¶ status ä¼šå˜æˆ 0ï¼Œç›´åˆ°åŠ è½½ä»¥å status å˜ä¸º 1ï¼ŒåŠ è½½å®Œæˆï¼Œæ­¤æ—¶ returnåŠ è½½å¥½çš„ç»„ä»¶ã€‚</p></li><li><p>ç„¶å <code>Promise resolve</code> åï¼ŒReact ä¼šé€šè¿‡ <code>attachPingListener</code> -&gt; <code>retrySuspenseBoundary</code> -&gt; <code>scheduleUpdateOnFiber()</code> æŠŠæŒ‚èµ·çš„ç»„ä»¶é‡æ–°åŠ å…¥åˆ°è°ƒåº¦é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±è°ƒåº¦å™¨ï¼ˆ<code>React Scheduler</code>ï¼‰æ ¹æ®ä¼˜å…ˆçº§å’Œç©ºé—²æ—¶é—´ å¼‚æ­¥åœ° é‡æ–°æ‰§è¡Œæ¸²æŸ“æµç¨‹ã€‚</p></li></ol>`,56),e=[o];function t(c,r,y,F,D,i){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
