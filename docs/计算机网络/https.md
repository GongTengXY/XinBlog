# HTTPS 详解

::: danger
写作中
:::

我们在 http 历程篇说到以此`http://www.baidu.com/`为例子，其实我们在访问百度的时候，不管你输入的是 http 还是 https 协议都会被转成`https协议`。为什么大家都要使用 `https协议` ？ 大家都说 `https协议` 安全，这篇就可以知道为什么 https 安全

## HTTPS 实现原理

大家可能都听说过 HTTPS 协议之所以是安全的是因为 HTTPS 协议会对传输的数据进行加密，而加密过程是使用了非对称加密实现。但其实：HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段。

HTTPS 的整体过程分为证书验证和数据传输阶段，具体的交互过程如下：

<img src="/https1.png" style="zoom:50%;" />

**① 证书验证阶段：**

1、浏览器发起 HTTPS 请求；  
2、服务端返回 HTTPS 证书；  
3、客户端验证证书是否合法，如果不合法则提示告警。

**② 数据传输阶段：**

1、当证书验证合法后，在本地生成随机数；  
2、通过公钥加密随机数，并把加密后的随机数传输到服务端；  
3、服务端通过私钥对随机数进行解密；  
4、服务端通过客户端传入的随机数构造对称加密算法，对返回结果内容进行加密后传输。

## TLS

刚开始听到 `TLS` 的时候，你可能还不太熟悉，但是说起 `SSL` 你可能就觉得好耳熟了。其实 `TLS` 就是从 `SSL` 发展而来的，只是 `SSL` 发展到 3.0 版本后改成了 `TLS`。

那么 TLS 协议有什么主要作用？

- 首先就是 加密

- 其次就是 身份验证，也可以叫证书验证吧

- 最后就是 消息完整性校验（这是网络协议中常用的一个校验和机制，这里就不说了）

### 加密算法

**对称加密**

对称加密算法是指加密和解密使用相同密钥的算法。常见的对称加密算法有 AES、DES、3DES、RC4、Blowfish、Twofish、CAST5、IDEA、RC2、SEED 等。

**非对称加密**

非对称加密算法是指加密和解密使用不同的密钥的算法。常见的非对称加密算法有 RSA、DSA、ECC、DH 等。

这里可能要提一下什么是对称加密和非对称加密：
一般的对称加密像这样：

```js
encrypt(明文，秘钥) = 密文
decrypt(密文，秘钥) = 明文
```

也就是说加密和解密用的是同一个秘钥。而非对称加密是这样的：

```js
encrypt(明文，公钥) = 密文
decrypt(密文，私钥) = 明文
```

加密和解密是需要不同的秘钥的。
经过这几次握手成功后，客服端和服务端之间通信的加密算法和所需要的密钥也就确定下来了，之后双方的交互都可以使用对称加密算法加密了。

> 很多人可能有疑问，为什么数据传输阶段的时候要用对称加密算法？

非对称加密的加解密效率是非常低的，而 http 的应用场景中通常端与端之间存在大量的交互，非对称加密的效率是无法接受的。
在 HTTPS 的场景中只有服务端保存了私钥，一对公私钥只能实现单向的加解密，所以 HTTPS 中内容传输加密采取的是对称加密，而不是非对称加密。

### 证书机制

在 TLS 中，我们需要证书来保证你所访问的服务器是真实的，可信的。

**证书里面又点啥东西信息：**

- 公钥
- 公司信息
- 证书签名算法
- 证书颁发机构
- 有效期
- 域名
- 指纹
- 等等.....

浏览器发起 HTTPS 请求时，服务器会返回网站的 SSL 证书，浏览器验证证书的过程如下：

1、验证域名、有效期等信息是否正确：证书上都有包含这些信息，比较容易完成验证；

2、判断证书来源是否合法：每份签发证书都可以根据验证链查找到对应的根证书，操作系统、浏览器会在本地存储权威机构的根证书，利用本地根证书可以对对应机构签发证书完成来源验证

3、判断证书是否被篡改：需要与 CA 服务器进行校验；

4、判断证书是否已吊销：通过 CRL（Certificate Revocation List 证书注销列表）和 OCSP（Online Certificate Status Protocol 在线证书状态协议）实现，其中 OCSP 可用于第 3 步中以减少与 CA 服务器的交互，提高验证效率

满足以上 4 步，浏览器才会认定证书是可信的，然后继续进行后面的流程。

## 中间人攻击

我们说了 SSL 证书，但是又为什么需要 SSL 证书，感觉又点怪麻烦的啊。其本意就是为了防范 **中间人攻击**。

TTP 协议被认为不安全是因为传输过程容易被监听者勾线监听、伪造服务器，而 HTTPS 协议主要解决的便是网络传输的安全性问题。首先我们假设不存在认证机构，任何人都可以制作证书，这带来的安全风险便是经典的“中间人攻击”问题。 凭下图理解：

<img src="/https2.png" style="zoom:50%;" />

> 多余的阐述不再多说，可根据此图理解
